#!/usr/bin/env bash
set -euo pipefail

# Default compose file
COMPOSE_FILE="docker-compose.yml"

# Parse optional arguments
while [[ $# -gt 0 ]]; do
  case "$1" in
    --file | -f)
      COMPOSE_FILE="$2"
      shift 2
      ;;
    up | down)
      action="$1"
      shift
      ;;
    *)
      echo "❌ Unknown argument: $1" >&2
      echo "Usage: $0 [--file PATH] {up|down}" >&2
      exit 1
      ;;
  esac
done

# Ensure action is set
if [[ -z "${action:-}" ]]; then
  echo "❌ You must specify 'up' or 'down'" >&2
  echo "Usage: $0 [--file PATH] {up|down}" >&2
  exit 1
fi

# Pick docker-compose or podman-compose
if command -v docker &>/dev/null; then
  compose_cmd="docker-compose"
elif command -v podman &>/dev/null; then
  compose_cmd="podman-compose"
else
  echo "❌ Neither docker nor podman is installed!" >&2
  exit 1
fi

echo "▶ Using $compose_cmd with compose file: $COMPOSE_FILE ..."
"$compose_cmd" -f "$COMPOSE_FILE" "$action"
